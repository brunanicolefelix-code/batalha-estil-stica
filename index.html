<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Figuras de Linguagem - Multiplayer Medieval</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e8d4b8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(180deg, #3d2817 0%, #2d1810 100%);
            border-bottom: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        header h1 {
            font-size: 2.5em;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 5px;
        }

        header p {
            color: #c9a961;
            font-size: 0.9em;
        }

        .container {
            flex: 1;
            max-width: 1400px;
            margin: 30px auto;
            width: 100%;
            padding: 0 20px;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .login-screen.hidden {
            display: none;
        }

        .login-screen h2 {
            color: #d4af37;
            font-size: 2em;
            margin-bottom: 30px;
        }

        .login-form {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form label {
            color: #c9a961;
            font-weight: bold;
        }

        .login-form input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
        }

        .login-form input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .login-button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            background: linear-gradient(135deg, #3d6b1f 0%, #2d5016 100%);
            transform: scale(1.02);
        }

        /* Rooms Selection */
        .rooms-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .rooms-section.hidden {
            display: none;
        }

        .room-card {
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .room-card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 8px 16px rgba(212, 175, 55, 0.3);
        }

        .room-card h2 {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .room-card button {
            background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%);
            color: #1a1a1a;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .room-card button:hover {
            background: linear-gradient(135deg, #e8c547 0%, #c9a961 100%);
            transform: scale(1.05);
        }

        /* Game Area */
        .game-area {
            display: none;
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .game-area.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .game-header h2 {
            color: #d4af37;
            font-size: 2em;
        }

        .player-info {
            color: #c9a961;
        }

        .back-button {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
            color: #e8d4b8;
            border: 2px solid #d4af37;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: linear-gradient(135deg, #a0522d 0%, #8b4513 100%);
        }

        /* Game Content */
        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .game-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Timer Section */
        .timer-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            text-align: center;
            grid-column: 1 / -1;
        }

        .timer-display {
            font-size: 3em;
            color: #d4af37;
            font-weight: bold;
            margin: 20px 0;
            font-family: 'Arial', sans-serif;
        }

        .timer-label {
            color: #c9a961;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* Category Display */
        .category-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            text-align: center;
            grid-column: 1 / -1;
        }

        .category-display {
            font-size: 2.5em;
            color: #d4af37;
            font-weight: bold;
            margin: 20px 0;
        }

        .category-label {
            color: #c9a961;
            font-size: 1.2em;
        }

        /* Input Section */
        .input-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .input-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group label {
            color: #c9a961;
            font-weight: bold;
        }

        .input-group textarea {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            min-height: 100px;
            resize: vertical;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .input-group textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .submit-button:hover:not(:disabled) {
            background: linear-gradient(135deg, #3d6b1f 0%, #2d5016 100%);
            transform: scale(1.02);
        }

        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Players List */
        .players-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            grid-column: 1 / -1;
        }

        .players-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
        }

        .players-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .player-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .player-name {
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .player-status {
            color: #c9a961;
            font-size: 0.9em;
        }

        .status-waiting {
            color: #ffa500;
        }

        .status-submitted {
            color: #7cfc00;
        }

        .player-points {
            color: #d4af37;
            font-weight: bold;
            margin-top: 8px;
        }

        /* Ranking */
        .ranking-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            grid-column: 1 / -1;
        }

        .ranking-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            color: #d4af37;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #8b7355;
            background: rgba(0, 0, 0, 0.5);
        }

        .ranking-table td {
            color: #e8d4b8;
            padding: 12px;
            border-bottom: 1px solid #8b7355;
        }

        .ranking-table tr:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        /* Status Message */
        .status-message {
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background: #2d5016;
            color: #7cfc00;
        }

        .status-error {
            background: #5a1a1a;
            color: #ff6b6b;
        }

        .status-info {
            background: #3d2817;
            color: #d4af37;
        }

        /* Footer */
        footer {
            background: linear-gradient(180deg, #2d1810 0%, #1a0f0a 100%);
            border-top: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
            margin-top: auto;
            color: #c9a961;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .timer-display {
                font-size: 2em;
            }

            .category-display {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>‚öîÔ∏è Jogo de Figuras de Linguagem - Multiplayer ‚öîÔ∏è</h1>
        <p>Crie frases √©picas com figuras de linguagem em tempo real</p>
    </header>

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h2>üè∞ Bem-vindo ao Jogo Multiplayer! üè∞</h2>
            <form class="login-form" onsubmit="iniciarJogo(event)">
                <label for="playerName">Digite seu nome de jogador:</label>
                <input 
                    type="text" 
                    id="playerName" 
                    placeholder="Seu nome aqui..." 
                    maxlength="50"
                    required
                    autofocus
                >
                <button type="submit" class="login-button">Entrar no Jogo</button>
            </form>
        </div>

        <!-- Rooms Selection -->
        <div id="roomsSection" class="rooms-section hidden">
            <div class="player-info" style="grid-column: 1 / -1; text-align: center; margin-bottom: 20px;">
                <span id="playerNameDisplay"></span>
                <button class="back-button" onclick="mudarJogador()" style="margin-left: 20px;">Trocar Jogador</button>
            </div>
            <div class="room-card">
                <h2>üè∞ Sala 1</h2>
                <p>Castelo do Conhecimento</p>
                <button onclick="enterRoom(1)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üèØ Sala 2</h2>
                <p>Torre da Sabedoria</p>
                <button onclick="enterRoom(2)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üóø Sala 3</h2>
                <p>Fortaleza da Criatividade</p>
                <button onclick="enterRoom(3)">Entrar</button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" class="game-area">
            <div class="game-header">
                <h2 id="roomTitle"></h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <span class="player-info" id="gamePlayerInfo"></span>
                    <button class="back-button" onclick="backToRooms()">‚Üê Voltar</button>
                </div>
            </div>

            <!-- Timer Section -->
            <div class="timer-section">
                <div class="timer-label" id="timerLabel">Preparando...</div>
                <div class="timer-display" id="timerDisplay">--</div>
            </div>

            <!-- Category Section -->
            <div class="category-section" id="categorySection" style="display: none;">
                <div class="category-label">Figura de Linguagem:</div>
                <div class="category-display" id="categoryDisplay">-</div>
            </div>

            <div class="game-content">
                <!-- Input Section -->
                <div class="input-section">
                    <h3>‚úçÔ∏è Sua Frase</h3>
                    <div class="input-group">
                        <textarea 
                            id="fraseUsuario" 
                            placeholder="Escreva sua frase aqui..."
                            disabled
                        ></textarea>
                    </div>
                    <button class="submit-button" id="submitBtn" onclick="enviarFrase()" disabled>Enviar Frase</button>
                    <div id="statusMessage"></div>
                </div>

                <!-- Players List -->
                <div class="players-section">
                    <h3>üë• Jogadores na Sala</h3>
                    <div class="players-list" id="playersList"></div>
                </div>
            </div>

            <!-- Ranking -->
            <div class="ranking-section">
                <h3>üèÜ Ranking da Sala</h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Posi√ß√£o</th>
                            <th>Jogador</th>
                            <th>Pontos</th>
                            <th>Frases Corretas</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #8b7355;">Carregando...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>Trabalho desenvolvido para a disciplina de Estil√≠stica do Texto - PUC Campinas</p>
    </footer>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB18wCa-yEhMYQkxY8ZlBoRIvBS1OAmjqg",
            authDomain: "estilistica.firebaseapp.com",
            databaseURL: "https://estilistica-default-rtdb.firebaseio.com",
            projectId: "estilistica",
            storageBucket: "estilistica.firebasestorage.app",
            messagingSenderId: "622934874774",
            appId: "1:622934874774:web:2ca073255bbf1b2d8f40b7",
            measurementId: "G-KJVPBTNTRJ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Figuras de Linguagem
        const figurasLinguagem = [
            "Met√°fora", "Meton√≠mia", "Sin√©doque", "Ant√≠tese", "Paradoxo",
            "Hip√©rbole", "Ironia", "Personifica√ß√£o", "Alitera√ß√£o", "Asson√¢ncia",
            "Onomatopeia", "Compara√ß√£o", "Catacrese", "Ox√≠moro", "Pleonasmo",
            "Tautologia", "Zeugma", "Elipse", "Anacoluto", "Invers√£o"
        ];

        // Game State
        let playerName = null;
        let currentRoom = null;
        let playerId = null;
        let gameState = null;
        let roundActive = false;
        let timerInterval = null;
        let timeRemaining = 0;

        // Initialize
        window.iniciarJogo = function(event) {
            event.preventDefault();
            playerName = document.getElementById('playerName').value.trim();
            
            if (!playerName) {
                alert('Por favor, digite seu nome!');
                return;
            }

            playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('roomsSection').classList.remove('hidden');
            document.getElementById('playerNameDisplay').textContent = `üë§ Jogador: ${playerName}`;
        };

        window.mudarJogador = function() {
            if (currentRoom) {
                backToRooms();
            }
            playerName = null;
            playerId = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('roomsSection').classList.add('hidden');
            document.getElementById('playerName').value = '';
            document.getElementById('playerName').focus();
        };

        window.enterRoom = function(roomNumber) {
            currentRoom = roomNumber;
            
            document.getElementById('roomsSection').classList.add('hidden');
            document.getElementById('gameArea').classList.add('active');
            document.getElementById('roomTitle').textContent = `Sala ${roomNumber}`;
            document.getElementById('gamePlayerInfo').textContent = `üë§ ${playerName}`;

            // Register player in Firebase
            const playerRef = database.ref(`salas/${currentRoom}/jogadores/${playerId}`);
            playerRef.set({
                nome: playerName,
                pontos: 0,
                frases_corretas: 0,
                frase_enviada: false,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });

            // Listen to game state
            const gameStateRef = database.ref(`salas/${currentRoom}/estado`);
            gameStateRef.on('value', (snapshot) => {
                gameState = snapshot.val();
                if (gameState) {
                    updateGameUI();
                }
            });

            // Listen to players
            const playersRef = database.ref(`salas/${currentRoom}/jogadores`);
            playersRef.on('value', (snapshot) => {
                updatePlayersList(snapshot.val());
                updateRanking();
            });

            // Start game loop
            startGameLoop();
        };

        window.backToRooms = function() {
            if (currentRoom) {
                // Remove player from Firebase
                database.ref(`salas/${currentRoom}/jogadores/${playerId}`).remove();
                
                // Stop listeners
                database.ref(`salas/${currentRoom}/estado`).off();
                database.ref(`salas/${currentRoom}/jogadores`).off();
            }

            currentRoom = null;
            roundActive = false;
            clearInterval(timerInterval);
            
            document.getElementById('roomsSection').classList.remove('hidden');
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('fraseUsuario').value = '';
            document.getElementById('fraseUsuario').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('statusMessage').innerHTML = '';
            document.getElementById('categorySection').style.display = 'none';
        };

        function startGameLoop() {
            setInterval(() => {
                const now = Date.now();
                const gameStateRef = database.ref(`salas/${currentRoom}/estado`);
                
                gameStateRef.once('value', (snapshot) => {
                    let state = snapshot.val();
                    
                    if (!state) {
                        // Initialize game state
                        state = {
                            fase: 'preparacao',
                            tempo_inicio: now,
                            categoria: null,
                            rodada: 1
                        };
                        gameStateRef.set(state);
                    }

                    const tempoDecorrido = now - state.tempo_inicio;
                    
                    if (state.fase === 'preparacao') {
                        if (tempoDecorrido < 10000) {
                            // Preparation phase
                            timeRemaining = Math.ceil((10000 - tempoDecorrido) / 1000);
                            updateTimer('Preparando...', timeRemaining);
                            roundActive = false;
                        } else {
                            // Start writing phase
                            const novaCategoria = figurasLinguagem[Math.floor(Math.random() * figurasLinguagem.length)];
                            gameStateRef.update({
                                fase: 'escrita',
                                tempo_inicio: now,
                                categoria: novaCategoria
                            });
                        }
                    } else if (state.fase === 'escrita') {
                        if (tempoDecorrido < 20000) {
                            // Writing phase
                            timeRemaining = Math.ceil((20000 - tempoDecorrido) / 1000);
                            updateTimer('Tempo para escrever:', timeRemaining);
                            roundActive = true;
                            document.getElementById('categorySection').style.display = 'block';
                            document.getElementById('categoryDisplay').textContent = `üé≠ ${state.categoria}`;
                            document.getElementById('fraseUsuario').disabled = false;
                            document.getElementById('submitBtn').disabled = false;
                        } else {
                            // End round
                            roundActive = false;
                            document.getElementById('fraseUsuario').disabled = true;
                            document.getElementById('submitBtn').disabled = true;
                            document.getElementById('statusMessage').innerHTML = '<div class="status-message status-info">Tempo encerrado! Pr√≥xima rodada em breve...</div>';
                            
                            // Reset for next round after 3 seconds
                            setTimeout(() => {
                                gameStateRef.update({
                                    fase: 'preparacao',
                                    tempo_inicio: Date.now(),
                                    categoria: null,
                                    rodada: (state.rodada || 1) + 1
                                });
                            }, 3000);
                        }
                    }
                });
            }, 500);
        }

        function updateTimer(label, seconds) {
            document.getElementById('timerLabel').textContent = label;
            document.getElementById('timerDisplay').textContent = seconds;
        }

        function updateGameUI() {
            if (!gameState) return;

            if (gameState.categoria) {
                document.getElementById('categorySection').style.display = 'block';
                document.getElementById('categoryDisplay').textContent = `üé≠ ${gameState.categoria}`;
            }
        }

        function updatePlayersList(players) {
            const playersList = document.getElementById('playersList');
            if (!players) {
                playersList.innerHTML = '<p style="color: #8b7355;">Nenhum jogador...</p>';
                return;
            }

            playersList.innerHTML = Object.entries(players).map(([id, player]) => `
                <div class="player-card">
                    <div class="player-name">${player.nome}</div>
                    <div class="player-status ${player.frase_enviada ? 'status-submitted' : 'status-waiting'}">
                        ${player.frase_enviada ? '‚úì Enviou' : '‚è≥ Aguardando'}
                    </div>
                    <div class="player-points">${player.pontos} pts</div>
                </div>
            `).join('');
        }

        function updateRanking() {
            const rankingBody = document.getElementById('rankingBody');
            const playersRef = database.ref(`salas/${currentRoom}/jogadores`);
            
            playersRef.once('value', (snapshot) => {
                const players = snapshot.val();
                if (!players) {
                    rankingBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #8b7355;">Carregando...</td></tr>';
                    return;
                }

                const ranking = Object.values(players)
                    .sort((a, b) => b.pontos - a.pontos);

                rankingBody.innerHTML = ranking.map((player, index) => `
                    <tr>
                        <td>#${index + 1}</td>
                        <td>${player.nome}</td>
                        <td><strong>${player.pontos}</strong></td>
                        <td>${player.frases_corretas}</td>
                    </tr>
                `).join('');
            });
        }

        window.enviarFrase = function() {
            if (!roundActive) {
                document.getElementById('statusMessage').innerHTML = '<div class="status-message status-error">Tempo encerrado!</div>';
                return;
            }

            const frase = document.getElementById('fraseUsuario').value.trim();
            
            if (!frase) {
                document.getElementById('statusMessage').innerHTML = '<div class="status-message status-error">Por favor, escreva uma frase!</div>';
                return;
            }

            if (!gameState || !gameState.categoria) {
                document.getElementById('statusMessage').innerHTML = '<div class="status-message status-error">Categoria n√£o carregada!</div>';
                return;
            }

            // Analyze phrase
            const resultado = analisarFrase(frase, gameState.categoria);
            const pontos = resultado.correto ? 10 : 0;

            // Update player in Firebase
            const playerRef = database.ref(`salas/${currentRoom}/jogadores/${playerId}`);
            playerRef.update({
                frase_enviada: true,
                pontos: firebase.database.ServerValue.increment(pontos),
                frases_corretas: firebase.database.ServerValue.increment(resultado.correto ? 1 : 0),
                ultima_frase: frase,
                ultima_categoria: gameState.categoria,
                ultima_analise: resultado.explicacao
            });

            document.getElementById('fraseUsuario').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('statusMessage').innerHTML = `<div class="status-message status-success">‚úì Frase enviada! ${pontos > 0 ? `Voc√™ ganhou ${pontos} pontos!` : ''}</div>`;
        };

        function analisarFrase(frase, figura) {
            const fraseMinuscula = frase.toLowerCase();
            const palavrasFrase = frase.split(/\s+/).filter(p => p.length > 2);

            if (frase.length < 10 || palavrasFrase.length < 5) {
                return { correto: false, explicacao: "Frase muito curta" };
            }

            let correto = false;

            switch(figura) {
                case "Met√°fora":
                    correto = /\b√©\b/.test(fraseMinuscula) && /\b(um|uma|o|a)\b/.test(fraseMinuscula);
                    break;
                case "Meton√≠mia":
                    correto = /\b(l√™|bebe|assiste|ouve|come|bate|toca)\b/.test(fraseMinuscula);
                    break;
                case "Hip√©rbole":
                    correto = /\b(milh√µes|infinito|eternidade|nunca|sempre)\b/.test(fraseMinuscula);
                    break;
                case "Ironia":
                    correto = /\b(claro|√≥bvio|l√≥gico|naturalmente)\b/.test(fraseMinuscula);
                    break;
                case "Personifica√ß√£o":
                    correto = /\b(dan√ßa|canta|chora|sorri|respira)\b/.test(fraseMinuscula);
                    break;
                case "Compara√ß√£o":
                    correto = /\bcomo\b/.test(fraseMinuscula);
                    break;
                case "Ant√≠tese":
                    correto = /\b(mas|por√©m|contudo)\b/.test(fraseMinuscula);
                    break;
                default:
                    correto = palavrasFrase.length >= 5;
            }

            return {
                correto: correto,
                explicacao: correto ? `√ìtimo! Voc√™ usou bem ${figura}.` : `Tente melhorar o uso de ${figura}.`
            };
        }
    </script>
</body>
</html>
