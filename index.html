<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batalha Estil√≠stica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e8d4b8;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(180deg, #3d2817 0%, #2d1810 100%);
            border-bottom: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            font-size: 2em;
            color: #d4af37;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .login-screen {
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            margin: 50px auto;
        }

        .hidden {
            display: none !important;
        }

        .login-screen h2 {
            color: #d4af37;
            margin-bottom: 30px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .login-form input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            font-size: 1em;
        }

        .login-form button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        .login-form button:hover {
            background: linear-gradient(135deg, #3d6b1f 0%, #2a4812 100%);
        }

        .rooms-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .room-card {
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .room-card h2 {
            color: #d4af37;
            margin-bottom: 10px;
        }

        .room-card button {
            background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%);
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .room-card button:hover {
            background: linear-gradient(135deg, #e8c547 0%, #c9a961 100%);
        }

        .game-area {
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .game-header h2 {
            color: #d4af37;
        }

        .back-button {
            background: #8b4513;
            color: #e8d4b8;
            border: 2px solid #d4af37;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .back-button:hover {
            background: #a0522d;
        }

        .timer-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-label {
            color: #c9a961;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .timer-display {
            font-size: 3em;
            color: #d4af37;
            font-weight: bold;
        }

        .sorteio-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .sorteio-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .sorteio-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            border: 2px solid #8b7355;
        }

        .sorteio-label {
            color: #c9a961;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .sorteio-valor {
            color: #d4af37;
            font-size: 1.8em;
            font-weight: bold;
        }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .input-section h3 {
            color: #d4af37;
            margin-bottom: 10px;
        }

        .input-section textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 10px;
            border-radius: 5px;
            min-height: 100px;
            font-family: 'Georgia', serif;
            resize: vertical;
            font-size: 1em;
        }

        .submit-button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
            font-size: 1em;
        }

        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .players-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .players-section h3 {
            color: #d4af37;
            margin-bottom: 10px;
        }

        .player-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .ranking-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            grid-column: 1 / -1;
        }

        .ranking-section h3 {
            color: #d4af37;
            margin-bottom: 10px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .ranking-table th {
            color: #d4af37;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #8b7355;
        }

        .ranking-table td {
            color: #e8d4b8;
            padding: 10px;
            border-bottom: 1px solid #8b7355;
        }

        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            background: #2d5016;
            color: #7cfc00;
        }

        footer {
            background: linear-gradient(180deg, #2d1810 0%, #1a0f0a 100%);
            border-top: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
            color: #c9a961;
        }

        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }
            .sorteio-display {
                grid-template-columns: 1fr;
            }
            .timer-display {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>‚öîÔ∏è Batalha Estil√≠stica ‚öîÔ∏è</h1>
    </header>

    <div class="container">
        <div id="loginScreen" class="login-screen">
            <h2>üè∞ Bem-vindo! üè∞</h2>
            <div class="login-form">
                <input type="text" id="playerNameInput" placeholder="Seu nome...">
                <button onclick="window.gameApp.iniciarJogo()">Entrar</button>
            </div>
        </div>

        <div id="roomsSection" class="rooms-section hidden">
            <div style="grid-column: 1/-1; text-align: center; margin-bottom: 20px;">
                <h2 style="color: #d4af37;">üë§ <span id="playerNameDisplay"></span></h2>
            </div>
            <div class="room-card">
                <h2>üè∞ Sala 1</h2>
                <button onclick="window.gameApp.enterRoom(1)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üóº Sala 2</h2>
                <button onclick="window.gameApp.enterRoom(2)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üèØ Sala 3</h2>
                <button onclick="window.gameApp.enterRoom(3)">Entrar</button>
            </div>
        </div>

        <div id="gameArea" class="game-area hidden">
            <div class="game-header">
                <h2 id="roomTitle">Sala 1</h2>
                <span style="color: #d4af37;">üë§ <span id="gamePlayerInfo"></span></span>
                <button class="back-button" onclick="window.gameApp.backToRooms()">Voltar</button>
            </div>

            <div class="timer-section">
                <div class="timer-label" id="timerLabel">Preparando...</div>
                <div class="timer-display" id="timerDisplay">10</div>
            </div>

            <div class="sorteio-section" id="sorteioSection">
                <h3>üìú Sorteado para esta rodada:</h3>
                <div class="sorteio-display">
                    <div class="sorteio-item">
                        <div class="sorteio-label">üìö Figura de Linguagem</div>
                        <div class="sorteio-valor" id="figuraSorteada">-</div>
                    </div>
                    <div class="sorteio-item">
                        <div class="sorteio-label">üìù Palavra</div>
                        <div class="sorteio-valor" id="palavraSorteada">-</div>
                    </div>
                </div>
            </div>

            <div class="game-content">
                <div class="input-section">
                    <h3>üñãÔ∏è Sua Frase:</h3>
                    <textarea id="fraseUsuario" placeholder="Escreva aqui..." disabled></textarea>
                    <button class="submit-button" id="submitBtn" onclick="window.gameApp.enviarFrase()" disabled>Enviar</button>
                    <div id="statusMessage"></div>
                </div>

                <div class="players-section">
                    <h3>üë• Jogadores na Sala</h3>
                    <div id="playersList"></div>
                </div>
            </div>

            <div class="ranking-section">
                <h3>üèÜ Ranking da Sala</h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Posi√ß√£o</th>
                            <th>Jogador</th>
                            <th>Pontos</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        Trabalho desenvolvido para a disciplina de Estil√≠stica do Texto - PUC Campinas
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
    <script>
        window.gameApp = {
            figuras: ["Met√°fora", "Meton√≠mia", "Hip√©rbole", "Ironia", "Personifica√ß√£o", "Compara√ß√£o", "Ant√≠tese", "Alitera√ß√£o", "Onomatopeia", "Paradoxo", "Sinestesia", "Oximoro", "Eufemismo", "Litote", "Sin√©doque"],
            palavras: ["Amor", "Morte", "Vida", "Luz", "Escurid√£o", "Tempestade", "Oceano", "Montanha", "Floresta", "Rio", "Fogo", "Gelo", "Vento", "Chuva", "Sil√™ncio", "Grito", "M√∫sica", "Dan√ßa", "Sonho", "Realidade", "Esperan√ßa", "Medo", "Coragem", "Fraqueza", "Beleza", "Fealdade", "Verdade", "Mentira", "Justi√ßa", "Injusti√ßa", "Paz", "Guerra", "Liberdade", "Pris√£o", "Riqueza", "Pobreza"],
            
            playerName: '',
            currentRoom: null,
            playerId: Math.random().toString(36).substr(2, 9),
            gameTimer: null,
            timeLeft: 10,
            gamePhase: 'prep',
            categoria: null,
            palavra: null,
            pontos: 0,
            db: null,
            
            iniciarFirebase: function() {
                try {
                    const firebaseConfig = {
                        apiKey: "AIzaSyB18wCa-yEhMYQkxY8ZlBoRIvBS1OAmjqg",
                        authDomain: "estilistica.firebaseapp.com",
                        databaseURL: "https://estilistica-default-rtdb.firebaseio.com",
                        projectId: "estilistica",
                        storageBucket: "estilistica.firebasestorage.app",
                        messagingSenderId: "622934874774",
                        appId: "1:622934874774:web:2ca073255bbf1b2d8f40b7",
                        measurementId: "G-KJVPBTNTRJ"
                    };
                    
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    this.db = firebase.database();
                } catch(e) {
                    console.log('Firebase n√£o dispon√≠vel, usando modo local');
                }
            },
            
            iniciarJogo: function() {
                const inputName = document.getElementById('playerNameInput').value.trim();
                if (!inputName) {
                    alert('Digite seu nome!');
                    return;
                }
                
                this.playerName = inputName;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('roomsSection').classList.remove('hidden');
                document.getElementById('playerNameDisplay').textContent = this.playerName;
            },
            
            enterRoom: function(roomNumber) {
                this.currentRoom = roomNumber;
                document.getElementById('roomsSection').classList.add('hidden');
                document.getElementById('gameArea').classList.remove('hidden');
                document.getElementById('roomTitle').textContent = `Sala ${roomNumber}`;
                document.getElementById('gamePlayerInfo').textContent = this.playerName;
                
                // Registrar no Firebase se dispon√≠vel
                if (this.db) {
                    try {
                        const playerRef = this.db.ref(`salas/sala${roomNumber}/jogadores/${this.playerId}`);
                        playerRef.set({
                            nome: this.playerName,
                            pontos: 0,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                        
                        const salaRef = this.db.ref(`salas/sala${roomNumber}`);
                        salaRef.on('value', (snapshot) => {
                            const data = snapshot.val();
                            if (data && data.jogadores) {
                                this.atualizarJogadores(data.jogadores);
                                this.atualizarRanking(data.jogadores);
                            }
                        });
                    } catch(e) {
                        console.log('Erro ao conectar Firebase');
                    }
                }
                
                this.startGameLoop();
            },
            
            backToRooms: function() {
                if (this.gameTimer) clearInterval(this.gameTimer);
                
                if (this.db && this.currentRoom) {
                    try {
                        const playerRef = this.db.ref(`salas/sala${this.currentRoom}/jogadores/${this.playerId}`);
                        playerRef.remove();
                    } catch(e) {}
                }
                
                this.currentRoom = null;
                this.gamePhase = 'prep';
                this.timeLeft = 10;
                this.pontos = 0;
                
                document.getElementById('roomsSection').classList.remove('hidden');
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('fraseUsuario').value = '';
                document.getElementById('fraseUsuario').disabled = true;
                document.getElementById('submitBtn').disabled = true;
                document.getElementById('statusMessage').innerHTML = '';
            },
            
            startGameLoop: function() {
                this.timeLeft = 10;
                this.gamePhase = 'prep';
                
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    document.getElementById('timerDisplay').textContent = Math.max(0, this.timeLeft);

                    if (this.gamePhase === 'prep' && this.timeLeft <= 0) {
                        this.gamePhase = 'escrita';
                        this.timeLeft = 20;
                        this.categoria = this.figuras[Math.floor(Math.random() * this.figuras.length)];
                        this.palavra = this.palavras[Math.floor(Math.random() * this.palavras.length)];
                        
                        if (this.db && this.currentRoom) {
                            try {
                                const salaRef = this.db.ref(`salas/sala${this.currentRoom}`);
                                salaRef.update({
                                    categoria: this.categoria,
                                    palavra: this.palavra,
                                    phase: 'escrita'
                                });
                            } catch(e) {}
                        }
                        
                        document.getElementById('timerLabel').textContent = 'Tempo para escrever:';
                        document.getElementById('figuraSorteada').textContent = this.categoria;
                        document.getElementById('palavraSorteada').textContent = this.palavra;
                        document.getElementById('sorteioSection').style.display = 'block';
                        document.getElementById('fraseUsuario').disabled = false;
                        document.getElementById('submitBtn').disabled = false;
                    } 
                    else if (this.gamePhase === 'escrita' && this.timeLeft <= 0) {
                        document.getElementById('fraseUsuario').disabled = true;
                        document.getElementById('submitBtn').disabled = true;
                        document.getElementById('statusMessage').innerHTML = '<div class="status-message">‚è∞ Tempo encerrado!</div>';
                        
                        setTimeout(() => {
                            document.getElementById('statusMessage').innerHTML = '';
                            document.getElementById('fraseUsuario').value = '';
                            document.getElementById('sorteioSection').style.display = 'none';
                            this.timeLeft = 10;
                            this.gamePhase = 'prep';
                            document.getElementById('timerLabel').textContent = 'Preparando...';
                        }, 3000);
                    }
                }, 1000);
            },
            
            enviarFrase: function() {
                const frase = document.getElementById('fraseUsuario').value.trim();
                
                if (!frase) {
                    alert('Escreva uma frase!');
                    return;
                }

                const analise = this.analisarFrase(frase, this.categoria);
                const pts = analise.correto ? 10 : 0;
                this.pontos += pts;

                if (this.db && this.currentRoom) {
                    try {
                        const playerRef = this.db.ref(`salas/sala${this.currentRoom}/jogadores/${this.playerId}`);
                        playerRef.update({ pontos: this.pontos });

                        const historicoRef = this.db.ref(`salas/sala${this.currentRoom}/historico`).push();
                        historicoRef.set({
                            jogador: this.playerName,
                            frase: frase,
                            figura: this.categoria,
                            palavra: this.palavra,
                            correto: analise.correto,
                            pontos: pts,
                            analise: analise.motivo,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                    } catch(e) {}
                }

                document.getElementById('fraseUsuario').disabled = true;
                document.getElementById('submitBtn').disabled = true;
                const statusText = analise.correto ? `‚úì Correto! ${pts} pts` : `‚úó Incorreto. ${analise.motivo}`;
                document.getElementById('statusMessage').innerHTML = `<div class="status-message">${statusText}</div>`;
            },
            
            atualizarJogadores: function(jogadores) {
                const playersList = document.getElementById('playersList');
                playersList.innerHTML = '';
                
                Object.values(jogadores).forEach(jogador => {
                    const card = document.createElement('div');
                    card.className = 'player-card';
                    card.textContent = `${jogador.nome}`;
                    playersList.appendChild(card);
                });
            },
            
            atualizarRanking: function(jogadores) {
                const rankingBody = document.getElementById('rankingBody');
                rankingBody.innerHTML = '';
                
                const jogadoresArray = Object.values(jogadores).sort((a, b) => b.pontos - a.pontos);
                
                jogadoresArray.forEach((jogador, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>#${index + 1}</td>
                        <td>${jogador.nome}</td>
                        <td>${jogador.pontos}</td>
                    `;
                    rankingBody.appendChild(row);
                });
            },
            
            analisarFrase: function(frase, figura) {
                const f = frase.toLowerCase();
                const palavrasArray = frase.split(/\s+/).filter(p => p.length > 2);

                // Valida√ß√£o b√°sica
                if (frase.length < 10 || palavrasArray.length < 4) {
                    return { correto: false, motivo: 'Frase muito curta' };
                }

                let pontuacao = 0;
                let motivos = [];

                switch(figura) {
                    case "Met√°fora":
                        if (/\b√©\b/.test(f)) pontuacao += 50;
                        if (/\b(como|semelhante|parece)\b/.test(f)) motivos.push('Detectada compara√ß√£o');
                        if (palavrasArray.length >= 6) pontuacao += 30;
                        if (/\b(beleza|luz|escurid√£o|fogo|gelo|tempestade|oceano)\b/.test(f)) pontuacao += 20;
                        break;
                        
                    case "Meton√≠mia":
                        if (/\b(l√™|bebe|assiste|ouve|come|escreve|pensa)\b/.test(f)) pontuacao += 60;
                        if (/\b(livro|vinho|filme|m√∫sica|comida|ideia)\b/.test(f)) pontuacao += 30;
                        if (palavrasArray.length >= 6) pontuacao += 10;
                        break;
                        
                    case "Hip√©rbole":
                        if (/\b(milh√µes|infinito|eternidade|nunca|sempre|morrer|explodir)\b/.test(f)) pontuacao += 60;
                        if (/\b(muito|demais|extremamente|absurdamente)\b/.test(f)) pontuacao += 30;
                        if (/\d+/.test(frase)) pontuacao += 20;
                        break;
                        
                    case "Ironia":
                        if (/\b(claro|√≥bvio|l√≥gico|naturalmente|evidentemente)\b/.test(f)) pontuacao += 50;
                        if (/[!?]{2,}/.test(frase)) pontuacao += 30;
                        if (palavrasArray.length >= 6) pontuacao += 20;
                        break;
                        
                    case "Personifica√ß√£o":
                        if (/\b(dan√ßa|canta|chora|sorri|respira|pensa|sente|ama|odeia|sussurra)\b/.test(f)) pontuacao += 70;
                        if (/\b(natureza|animal|objeto|coisa)\b/.test(f)) pontuacao += 20;
                        break;
                        
                    case "Compara√ß√£o":
                        if (/\bcomo\b/.test(f)) pontuacao += 60;
                        if (/\b(semelhante|parecido|igual)\b/.test(f)) pontuacao += 40;
                        if (palavrasArray.length >= 6) pontuacao += 20;
                        break;
                        
                    case "Ant√≠tese":
                        if (/\b(mas|por√©m|contudo|todavia|entretanto|por√©m)\b/.test(f)) pontuacao += 60;
                        if (/(\w+).*\b(n√£o|nem)\b.*\1/.test(f)) pontuacao += 30;
                        if (palavrasArray.length >= 6) pontuacao += 10;
                        break;
                        
                    case "Alitera√ß√£o":
                        const palavras = frase.split(/\s+/);
                        const primeirasLetras = palavras.map(p => p[0]);
                        const repeticoes = primeirasLetras.filter((l, i) => i > 0 && l === primeirasLetras[i-1]).length;
                        if (repeticoes >= 2) pontuacao += 70;
                        break;
                        
                    case "Onomatopeia":
                        if (/\b(buzz|bang|splash|crash|boom|zzzz|pum|bum|plim)\b/.test(f)) pontuacao += 80;
                        if (/\b(som|ru√≠do|barulho|estrondo)\b/.test(f)) pontuacao += 30;
                        break;
                        
                    case "Paradoxo":
                        if (/\b(verdade|mentira|morte|vida|sil√™ncio|grito)\b/.test(f)) pontuacao += 40;
                        if (/\b(mas|por√©m|contudo)\b/.test(f)) pontuacao += 30;
                        if (palavrasArray.length >= 7) pontuacao += 20;
                        break;
                        
                    case "Sinestesia":
                        if (/\b(cor|som|gosto|cheiro|toque|quente|frio|doce|amargo|√°spero|suave)\b/.test(f)) pontuacao += 50;
                        if (/(\b(vermelho|azul|verde|amarelo|preto|branco)\b.*(som|grito|m√∫sica|voz))|(som|grito|m√∫sica|voz).*(vermelho|azul|verde|amarelo|preto|branco)/.test(f)) pontuacao += 50;
                        break;
                        
                    case "Oximoro":
                        if (/\b(sil√™ncio|grito|morte|vida|escurid√£o|luz|fogo|gelo)\b/.test(f)) pontuacao += 40;
                        if (palavrasArray.length >= 6) pontuacao += 20;
                        break;
                        
                    case "Eufemismo":
                        if (/\b(partir|descansar|dormir|ir|deixar|faltar)\b/.test(f)) pontuacao += 50;
                        if (/\b(morte|morrer|morto)\b/.test(f) && /\b(partir|descansar|dormir)\b/.test(f)) pontuacao += 30;
                        break;
                        
                    case "Litote":
                        if (/\b(n√£o √©|n√£o √© t√£o|n√£o √© muito)\b/.test(f)) pontuacao += 60;
                        if (/\b(nada|nenhum|nunca)\b/.test(f)) pontuacao += 30;
                        break;
                        
                    case "Sin√©doque":
                        if (/\b(cabe√ßa|m√£o|cora√ß√£o|alma|corpo)\b/.test(f)) pontuacao += 50;
                        if (palavrasArray.length >= 6) pontuacao += 20;
                        break;
                        
                    default:
                        pontuacao = palavrasArray.length >= 5 ? 40 : 0;
                }

                // B√¥nus por tamanho
                if (palavrasArray.length >= 8) pontuacao += 10;
                if (palavrasArray.length >= 10) pontuacao += 10;

                const correto = pontuacao >= 50;
                return { correto: correto, pontuacao: pontuacao, motivo: correto ? 'Frase v√°lida!' : 'Frase n√£o atende aos crit√©rios' };
            }
        };
        
        // Inicializar Firebase quando a p√°gina carregar
        window.addEventListener('load', function() {
            window.gameApp.iniciarFirebase();
        });
        
        // Limpar ao sair
        window.addEventListener('beforeunload', function() {
            if (window.gameApp.currentRoom && window.gameApp.db) {
                try {
                    const playerRef = window.gameApp.db.ref(`salas/sala${window.gameApp.currentRoom}/jogadores/${window.gameApp.playerId}`);
                    playerRef.remove();
                } catch(e) {}
            }
        });
    </script>
</body>
</html>
