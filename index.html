<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Figuras de Linguagem - Medieval</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e8d4b8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: linear-gradient(180deg, #3d2817 0%, #2d1810 100%);
            border-bottom: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        header h1 {
            font-size: 2.5em;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 5px;
        }

        header p {
            color: #c9a961;
            font-size: 0.9em;
        }

        /* Main Container */
        .container {
            flex: 1;
            max-width: 1200px;
            margin: 30px auto;
            width: 100%;
            padding: 0 20px;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .login-screen.hidden {
            display: none;
        }

        .login-screen h2 {
            color: #d4af37;
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
        }

        .login-form {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form label {
            color: #c9a961;
            font-weight: bold;
            font-size: 1.1em;
        }

        .login-form input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            font-size: 1em;
        }

        .login-form input::placeholder {
            color: #8b7355;
        }

        .login-form input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .login-button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-button:hover {
            background: linear-gradient(135deg, #3d6b1f 0%, #2d5016 100%);
            transform: scale(1.02);
        }

        .login-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Rooms Selection */
        .rooms-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .rooms-section.hidden {
            display: none;
        }

        .room-card {
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .room-card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 8px 16px rgba(212, 175, 55, 0.3);
        }

        .room-card h2 {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .room-card p {
            color: #c9a961;
            margin-bottom: 15px;
        }

        .room-card button {
            background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%);
            color: #1a1a1a;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .room-card button:hover {
            background: linear-gradient(135deg, #e8c547 0%, #c9a961 100%);
            transform: scale(1.05);
        }

        /* Game Area */
        .game-area {
            display: none;
            background: linear-gradient(135deg, #3d2817 0%, #2d1810 100%);
            border: 3px solid #8b7355;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .game-area.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .game-header h2 {
            color: #d4af37;
            font-size: 2em;
        }

        .player-info {
            color: #c9a961;
            font-size: 0.95em;
        }

        .back-button {
            background: linear-gradient(135deg, #8b4513 0%, #654321 100%);
            color: #e8d4b8;
            border: 2px solid #d4af37;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: linear-gradient(135deg, #a0522d 0%, #8b4513 100%);
        }

        /* Game Content */
        .game-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .game-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Buttons Section */
        .buttons-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .buttons-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .button-group button {
            flex: 1;
            background: linear-gradient(135deg, #d4af37 0%, #aa8c2c 100%);
            color: #1a1a1a;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .button-group button:hover {
            background: linear-gradient(135deg, #e8c547 0%, #c9a961 100%);
            transform: scale(1.02);
        }

        .display-box {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d4af37;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Input Section */
        .input-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
        }

        .input-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group label {
            color: #c9a961;
            font-weight: bold;
        }

        .input-group textarea {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8b7355;
            color: #e8d4b8;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            font-size: 1em;
            resize: vertical;
            min-height: 100px;
        }

        .input-group textarea::placeholder {
            color: #8b7355;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .submit-button {
            background: linear-gradient(135deg, #2d5016 0%, #1a3009 100%);
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .submit-button:hover {
            background: linear-gradient(135deg, #3d6b1f 0%, #2d5016 100%);
            transform: scale(1.02);
        }

        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* History Section */
        .history-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            grid-column: 1 / -1;
        }

        .history-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: rgba(0, 0, 0, 0.5);
            border-left: 4px solid #d4af37;
            padding: 15px;
            border-radius: 5px;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-item-name {
            color: #d4af37;
            font-weight: bold;
        }

        .history-item-status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-correct {
            background: #2d5016;
            color: #7cfc00;
        }

        .status-incorrect {
            background: #5a1a1a;
            color: #ff6b6b;
        }

        .history-item-phrase {
            color: #e8d4b8;
            margin-bottom: 8px;
            font-style: italic;
        }

        .history-item-correction {
            color: #c9a961;
            font-size: 0.95em;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 3px;
            margin-top: 8px;
        }

        .history-item-points {
            color: #d4af37;
            font-weight: bold;
            margin-top: 8px;
        }

        /* Ranking Section */
        .ranking-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #8b7355;
            grid-column: 1 / -1;
        }

        .ranking-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table thead {
            background: rgba(0, 0, 0, 0.5);
        }

        .ranking-table th {
            color: #d4af37;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #8b7355;
        }

        .ranking-table td {
            color: #e8d4b8;
            padding: 12px;
            border-bottom: 1px solid #8b7355;
        }

        .ranking-table tr:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .ranking-position {
            color: #d4af37;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Footer */
        footer {
            background: linear-gradient(180deg, #2d1810 0%, #1a0f0a 100%);
            border-top: 3px solid #8b7355;
            padding: 20px;
            text-align: center;
            margin-top: auto;
            color: #c9a961;
            font-size: 0.9em;
        }

        /* Loading and Status */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #8b7355;
            border-top-color: #d4af37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background: #2d5016;
            color: #7cfc00;
        }

        .status-error {
            background: #5a1a1a;
            color: #ff6b6b;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .game-header {
                flex-direction: column;
                align-items: stretch;
            }

            .game-header h2 {
                font-size: 1.5em;
            }

            .ranking-table {
                font-size: 0.9em;
            }

            .ranking-table th,
            .ranking-table td {
                padding: 8px;
            }

            .login-screen {
                min-height: 300px;
                padding: 30px 20px;
            }
        }

        /* Scrollbar Styling */
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: #8b7355;
            border-radius: 10px;
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: #d4af37;
        }
    </style>
</head>
<body>
    <header>
        <h1>‚öîÔ∏è Jogo de Figuras de Linguagem ‚öîÔ∏è</h1>
        <p>Crie frases √©picas com figuras de linguagem</p>
    </header>

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h2>üè∞ Bem-vindo ao Jogo! üè∞</h2>
            <form class="login-form" onsubmit="iniciarJogo(event)">
                <label for="playerName">Digite seu nome de jogador:</label>
                <input 
                    type="text" 
                    id="playerName" 
                    placeholder="Seu nome aqui..." 
                    maxlength="50"
                    required
                    autofocus
                >
                <button type="submit" class="login-button">Entrar no Jogo</button>
            </form>
        </div>

        <!-- Rooms Selection -->
        <div id="roomsSection" class="rooms-section hidden">
            <div class="player-info" style="grid-column: 1 / -1; text-align: center; margin-bottom: 20px;">
                <span id="playerNameDisplay"></span>
                <button class="back-button" onclick="mudarJogador()" style="margin-left: 20px;">Trocar Jogador</button>
            </div>
            <div class="room-card">
                <h2>üè∞ Sala 1</h2>
                <p>Castelo do Conhecimento</p>
                <button onclick="enterRoom(1)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üèØ Sala 2</h2>
                <p>Torre da Sabedoria</p>
                <button onclick="enterRoom(2)">Entrar</button>
            </div>
            <div class="room-card">
                <h2>üóø Sala 3</h2>
                <p>Fortaleza da Criatividade</p>
                <button onclick="enterRoom(3)">Entrar</button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" class="game-area">
            <div class="game-header">
                <h2 id="roomTitle"></h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <span class="player-info" id="gamePlayerInfo"></span>
                    <button class="back-button" onclick="backToRooms()">‚Üê Voltar</button>
                </div>
            </div>

            <div class="game-content">
                <!-- Left Column: Sorteios -->
                <div class="game-column">
                    <div class="buttons-section">
                        <h3>üé≤ Sorteios</h3>
                        <div class="button-group">
                            <button onclick="sortearPalavra()">Sortear Palavra</button>
                            <button onclick="sortearFigura()">Sortear Figura</button>
                        </div>
                        <div class="display-box" id="palavraSorteada">Clique para sortear uma palavra</div>
                        <div style="margin-top: 15px;"></div>
                        <div class="display-box" id="figuraSorteada">Clique para sortear uma figura</div>
                    </div>
                </div>

                <!-- Right Column: Input -->
                <div class="game-column">
                    <div class="input-section">
                        <h3>‚úçÔ∏è Sua Contribui√ß√£o</h3>
                        <div class="input-group">
                            <label for="fraseUsuario">Sua Frase:</label>
                            <textarea id="fraseUsuario" placeholder="Escreva uma frase usando a figura de linguagem sorteada..."></textarea>
                        </div>
                        <button class="submit-button" id="submitBtn" onclick="enviarFrase()">Enviar Frase</button>
                        <div id="statusMessage"></div>
                    </div>
                </div>
            </div>

            <!-- History Section -->
            <div class="history-section">
                <h3>üìú Hist√≥rico de Frases</h3>
                <div class="history-list" id="historyList">
                    <p style="color: #8b7355;">Nenhuma frase enviada ainda...</p>
                </div>
            </div>

            <!-- Ranking Section -->
            <div class="ranking-section">
                <h3>üèÜ Ranking da Sala</h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Posi√ß√£o</th>
                            <th>Jogador</th>
                            <th>Pontos</th>
                            <th>Frases Corretas</th>
                        </tr>
                    </thead>
                    <tbody id="rankingBody">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #8b7355;">Nenhum jogador ainda...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>Trabalho desenvolvido para a disciplina de Estil√≠stica do Texto - PUC Campinas</p>
    </footer>

    <script>
        // ===== DADOS LOCAIS (RESETAM AO SAIR DA P√ÅGINA) =====
        const historicoFrases = {};
        const rankingPorSala = {};

        // Figuras de Linguagem
        const figurasLinguagem = [
            "Met√°fora",
            "Meton√≠mia",
            "Sin√©doque",
            "Ant√≠tese",
            "Paradoxo",
            "Hip√©rbole",
            "Ironia",
            "Personifica√ß√£o",
            "Alitera√ß√£o",
            "Asson√¢ncia",
            "Onomatopeia",
            "Compara√ß√£o",
            "Catacrese",
            "Ox√≠moro",
            "Pleonasmo",
            "Tautologia",
            "Zeugma",
            "Elipse",
            "Anacoluto",
            "Invers√£o"
        ];

        // Palavras para Sorteio
        const palavras = [
            "Cora√ß√£o", "Tempestade", "Luz", "Escurid√£o", "Fogo", "Gelo", "Vento", "Chuva",
            "Montanha", "Rio", "Floresta", "Deserto", "Mar", "C√©u", "Terra", "Ar",
            "Amor", "√ìdio", "Medo", "Esperan√ßa", "Raiva", "Tristeza", "Alegria", "Paz",
            "Guerra", "Vit√≥ria", "Derrota", "Coragem", "Fraqueza", "For√ßa", "Poder", "Gl√≥ria",
            "Sombra", "Espelho", "Ponte", "Porta", "Caminho", "Jornada", "Destino", "Sorte",
            "Sonho", "Realidade", "Verdade", "Mentira", "Sil√™ncio", "Grito", "Sussurro", "Eco"
        ];

        // ===== IA MELHORADA =====
        function analisarFrase(frase, figura) {
            try {
                // Verifica se a frase tem tamanho m√≠nimo
                if (!frase || frase.length < 10) {
                    return {
                        correto: false,
                        explicacao: "A frase √© muito curta. Tente escrever uma frase mais completa com pelo menos 10 caracteres.",
                        sugestao: "Exemplo: 'O cora√ß√£o √© um tambor que bate na noite.'"
                    };
                }

                const fraseMinuscula = frase.toLowerCase();
                const palavrasFrase = frase.split(/\s+/).filter(p => p.length > 2);

                // Verifica se tem pelo menos 5 palavras
                if (palavrasFrase.length < 5) {
                    return {
                        correto: false,
                        explicacao: "A frase precisa ter mais palavras para demonstrar bem a figura de linguagem.",
                        sugestao: "Tente expandir sua frase com mais detalhes."
                    };
                }

                // An√°lise por figura de linguagem
                let correto = false;
                let explicacao = "";

                switch(figura) {
                    case "Met√°fora":
                        // Procura por "√©" seguido de palavras descritivas
                        if (/\b√©\b/.test(fraseMinuscula) && 
                            /\b(um|uma|o|a)\b/.test(fraseMinuscula) &&
                            palavrasFrase.length >= 5) {
                            correto = true;
                            explicacao = "Excelente! Sua frase usa bem a met√°fora, comparando conceitos de forma po√©tica.";
                        } else {
                            explicacao = "A frase n√£o demonstra claramente uma met√°fora. Tente usar '√©' para fazer uma compara√ß√£o po√©tica (ex: 'A vida √© um jardim').";
                        }
                        break;

                    case "Meton√≠mia":
                        if (/\b(l√™|bebe|assiste|ouve|come|bate|toca)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "√ìtimo! Sua frase demonstra bem o uso de meton√≠mia com uma a√ß√£o que substitui o conceito.";
                        } else {
                            explicacao = "A meton√≠mia substitui uma coisa por outra. Tente usar verbos de a√ß√£o (l√™, bebe, assiste, etc).";
                        }
                        break;

                    case "Hip√©rbole":
                        if (/\b(milh√µes|infinito|eternidade|nunca|sempre|mil|bilh√µes|imposs√≠vel)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "Perfeito! Sua frase usa hip√©rbole com exagero para criar efeito dram√°tico.";
                        } else {
                            explicacao = "A hip√©rbole √© um exagero. Tente usar palavras como 'milh√µes', 'eternidade', 'nunca', 'sempre'.";
                        }
                        break;

                    case "Ironia":
                        if (/\b(claro|√≥bvio|l√≥gico|naturalmente|√© claro|bem|muito bem)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "Excelente! Sua frase demonstra ironia com uma afirma√ß√£o que sugere o oposto.";
                        } else {
                            explicacao = "A ironia diz o oposto do que se quer expressar. Tente usar palavras que sugiram sarcasmo.";
                        }
                        break;

                    case "Personifica√ß√£o":
                        if (/\b(dan√ßa|canta|chora|sorri|respira|pensa|sente|sussurra|grita)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "Muito bom! Sua frase personifica bem, atribuindo a√ß√µes humanas a seres inanimados.";
                        } else {
                            explicacao = "A personifica√ß√£o atribui qualidades humanas a coisas. Tente usar verbos como 'dan√ßa', 'canta', 'chora', 'sorri'.";
                        }
                        break;

                    case "Compara√ß√£o":
                        if (/\bcomo\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "√ìtimo! Sua frase usa bem a compara√ß√£o com a palavra 'como'.";
                        } else {
                            explicacao = "A compara√ß√£o usa 'como' para relacionar duas coisas. Tente incluir essa palavra.";
                        }
                        break;

                    case "Ant√≠tese":
                        if (/\b(mas|por√©m|contudo|entretanto|todavia)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "Excelente! Sua frase demonstra ant√≠tese com contraste entre ideias.";
                        } else {
                            explicacao = "A ant√≠tese contrasta ideias opostas. Use conectivos como 'mas', 'por√©m', 'contudo'.";
                        }
                        break;

                    case "Paradoxo":
                        if (/\b(e|mas|apesar|embora)\b/.test(fraseMinuscula) && palavrasFrase.length >= 6) {
                            correto = true;
                            explicacao = "Muito bom! Sua frase apresenta bem um paradoxo com ideias contradit√≥rias.";
                        } else {
                            explicacao = "O paradoxo une ideias contradit√≥rias. Tente expressar conceitos que se op√µem.";
                        }
                        break;

                    case "Onomatopeia":
                        if (/\b(bang|boom|crash|splash|zzzz|tique|taque|pum|zum)\b/.test(fraseMinuscula)) {
                            correto = true;
                            explicacao = "Perfeito! Sua frase usa bem onomatopeia para imitar sons.";
                        } else {
                            explicacao = "A onomatopeia imita sons. Tente incluir palavras que representem sons (bang, boom, splash, etc).";
                        }
                        break;

                    case "Alitera√ß√£o":
                        // Verifica repeti√ß√£o de sons iniciais
                        const palavras_lista = fraseMinuscula.split(/\s+/);
                        let temAliteracao = false;
                        for (let i = 0; i < palavras_lista.length - 1; i++) {
                            if (palavras_lista[i][0] === palavras_lista[i + 1][0]) {
                                temAliteracao = true;
                                break;
                            }
                        }
                        if (temAliteracao) {
                            correto = true;
                            explicacao = "Excelente! Sua frase demonstra alitera√ß√£o com repeti√ß√£o de sons.";
                        } else {
                            explicacao = "A alitera√ß√£o repete sons iniciais de palavras. Tente: 'Sete s√°bios saltam sobre a seda'.";
                        }
                        break;

                    default:
                        // Para outras figuras, aceita se a frase tem bom tamanho
                        if (palavrasFrase.length >= 5) {
                            correto = true;
                            explicacao = `Boa frase! Voc√™ demonstrou o uso de ${figura}.`;
                        } else {
                            explicacao = `Tente expandir sua frase para melhor demonstrar ${figura}.`;
                        }
                }

                return {
                    correto: correto,
                    explicacao: explicacao,
                    sugestao: ""
                };

            } catch (erro) {
                console.error("Erro na an√°lise:", erro);
                return {
                    correto: false,
                    explicacao: "Houve um erro ao analisar a frase. Tente novamente!",
                    sugestao: ""
                };
            }
        }

        // Estado Global
        let currentRoom = null;
        let currentPalavra = null;
        let currentFigura = null;
        let playerName = null;

        // Fun√ß√µes P√∫blicas
        window.iniciarJogo = function(event) {
            event.preventDefault();
            playerName = document.getElementById('playerName').value.trim();
            
            if (!playerName) {
                alert('Por favor, digite seu nome!');
                return;
            }

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('roomsSection').classList.remove('hidden');
            document.getElementById('playerNameDisplay').textContent = `üë§ Jogador: ${playerName}`;
        };

        window.mudarJogador = function() {
            playerName = null;
            currentRoom = null;
            currentPalavra = null;
            currentFigura = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('roomsSection').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('playerName').value = '';
            document.getElementById('playerName').focus();
        };

        window.enterRoom = function(roomNumber) {
            currentRoom = roomNumber;
            if (!historicoFrases[roomNumber]) {
                historicoFrases[roomNumber] = [];
            }
            if (!rankingPorSala[roomNumber]) {
                rankingPorSala[roomNumber] = {};
            }
            
            document.getElementById('roomsSection').classList.add('hidden');
            document.getElementById('gameArea').classList.add('active');
            document.getElementById('roomTitle').textContent = `Sala ${roomNumber}`;
            document.getElementById('gamePlayerInfo').textContent = `üë§ ${playerName}`;
            carregarHistorico();
            carregarRanking();
        };

        window.backToRooms = function() {
            currentRoom = null;
            currentPalavra = null;
            currentFigura = null;
            document.getElementById('roomsSection').classList.remove('hidden');
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('fraseUsuario').value = '';
            document.getElementById('statusMessage').innerHTML = '';
            document.getElementById('palavraSorteada').textContent = 'Clique para sortear uma palavra';
            document.getElementById('figuraSorteada').textContent = 'Clique para sortear uma figura';
        };

        window.sortearPalavra = function() {
            currentPalavra = palavras[Math.floor(Math.random() * palavras.length)];
            document.getElementById('palavraSorteada').textContent = `üìù ${currentPalavra}`;
        };

        window.sortearFigura = function() {
            currentFigura = figurasLinguagem[Math.floor(Math.random() * figurasLinguagem.length)];
            document.getElementById('figuraSorteada').textContent = `üé≠ ${currentFigura}`;
        };

        window.enviarFrase = function() {
            const frase = document.getElementById('fraseUsuario').value.trim();
            const statusDiv = document.getElementById('statusMessage');

            if (!frase) {
                statusDiv.innerHTML = '<div class="status-message status-error">Por favor, escreva uma frase!</div>';
                return;
            }

            if (!currentFigura) {
                statusDiv.innerHTML = '<div class="status-message status-error">Por favor, sorteie uma figura de linguagem!</div>';
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            statusDiv.innerHTML = '<div class="status-message" style="background: #3d2817; color: #d4af37;"><span class="loading"></span> Analisando sua frase...</div>';

            // Simular an√°lise com delay
            setTimeout(() => {
                try {
                    const resultado = analisarFrase(frase, currentFigura);
                    const pontos = resultado.correto ? 10 : 0;

                    // Salvar no hist√≥rico local
                    const fraseData = {
                        nome: playerName,
                        frase: frase,
                        figura: currentFigura,
                        palavra: currentPalavra,
                        correto: resultado.correto,
                        explicacao: resultado.explicacao,
                        sugestao: resultado.sugestao,
                        pontos: pontos,
                        timestamp: new Date().toISOString()
                    };

                    historicoFrases[currentRoom].push(fraseData);

                    // Atualizar ranking
                    if (!rankingPorSala[currentRoom][playerName]) {
                        rankingPorSala[currentRoom][playerName] = {
                            pontos: 0,
                            frases_corretas: 0
                        };
                    }
                    rankingPorSala[currentRoom][playerName].pontos += pontos;
                    rankingPorSala[currentRoom][playerName].frases_corretas += (pontos > 0 ? 1 : 0);

                    // Limpar campos
                    document.getElementById('fraseUsuario').value = '';
                    statusDiv.innerHTML = `<div class="status-message status-success">‚úì Frase enviada com sucesso! ${pontos > 0 ? `Voc√™ ganhou ${pontos} pontos!` : 'Tente novamente!'}</div>`;

                    // Recarregar hist√≥rico e ranking
                    carregarHistorico();
                    carregarRanking();
                    submitBtn.disabled = false;
                } catch (erro) {
                    console.error("Erro:", erro);
                    statusDiv.innerHTML = '<div class="status-message status-error">Erro ao processar. Tente novamente!</div>';
                    submitBtn.disabled = false;
                }
            }, 800);
        };

        function carregarHistorico() {
            const historyList = document.getElementById('historyList');
            const frases = historicoFrases[currentRoom] || [];

            if (frases.length === 0) {
                historyList.innerHTML = '<p style="color: #8b7355;">Nenhuma frase enviada ainda...</p>';
                return;
            }

            // Mostrar em ordem reversa (mais recentes primeiro)
            const frasesOrdenadas = [...frases].reverse();

            historyList.innerHTML = frasesOrdenadas.map((frase) => `
                <div class="history-item">
                    <div class="history-item-header">
                        <span class="history-item-name">${frase.nome}</span>
                        <span class="history-item-status ${frase.correto ? 'status-correct' : 'status-incorrect'}">
                            ${frase.correto ? '‚úì Correto' : '‚úó Incorreto'}
                        </span>
                        <span class="history-item-points">${frase.pontos} pts</span>
                    </div>
                    <div style="color: #c9a961; font-size: 0.9em; margin-bottom: 8px;">
                        <strong>Figura:</strong> ${frase.figura} | <strong>Palavra:</strong> ${frase.palavra || 'N/A'}
                    </div>
                    <div class="history-item-phrase">"${frase.frase}"</div>
                    <div class="history-item-correction">
                        <strong>An√°lise:</strong> ${frase.explicacao}
                        ${frase.sugestao ? `<br><strong>Sugest√£o:</strong> ${frase.sugestao}` : ''}
                    </div>
                </div>
            `).join('');
        }

        function carregarRanking() {
            const rankingBody = document.getElementById('rankingBody');
            const ranking = rankingPorSala[currentRoom] || {};
            const jogadores = Object.entries(ranking).map(([nome, dados]) => ({
                nome,
                ...dados
            })).sort((a, b) => b.pontos - a.pontos);

            if (jogadores.length === 0) {
                rankingBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #8b7355;">Nenhum jogador ainda...</td></tr>';
                return;
            }

            rankingBody.innerHTML = jogadores.map((jogador, index) => `
                <tr>
                    <td><span class="ranking-position">#${index + 1}</span></td>
                    <td>${jogador.nome}</td>
                    <td><strong>${jogador.pontos}</strong></td>
                    <td>${jogador.frases_corretas}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
